# This file is generated by greenstar scripts. DO NOT EDIT.
openapi: 3.1.0
info:
  title: "{{ .Metadata.DisplayName }}"
  description: "{{ .Metadata.Description }}"
  contact:
    email: "{{ .Metadata.Contact.Email }}"
  version: "{{ .Metadata.Version }}"
servers:
  - url: "{{ .Metadata.Server }}"
tags:
  {{- range .Models }}
  - name: "{{ .Name }}"
  {{- end }}
paths:
  {{- range .Models }}
  "{{ .Path }}":
    {{- if .List }}
    get:
      summary: Fetch list of {{ .Name | lower | toPlural }}.
      tags:
        - "{{ .Name }}"
      parameters:
        - $ref: '#/components/parameters/X-GreenSTAR-Tenant-ID'
        - $ref: '#/components/parameters/X-Request-ID'
        - name: _offset
          in: query
          schema:
            type: integer
            nullable: false
            example: 0
        - name: _count
          in: query
          schema:
            type: integer
            nullable: false
            example: 10
        {{- range $name, $f := .List.Filters }}
        - name: {{ $name | toLowerCamelCase }}
          in: query
          schema:
            type: {{ $f.Type.OpenAPIType }}
            {{- if $f.Type.OpenAPIFormat }}
            format: {{ $f.Type.OpenAPIFormat }}
            {{- end }}
            nullable: true
        {{- end }}
        {{- range $name, $p := .List.Parameters }}
        - name: {{ $name | toLowerCamelCase }}
          in: query
          schema:
            type: {{ $p.Type.OpenAPIType }}
            {{- if $p.Type.OpenAPIFormat }}
            format: {{ $p.Type.OpenAPIFormat }}
            {{- end }}
            nullable: true
        {{- end }}
      responses:
        '200':
          description: {{ .Name | toPlural }} fetched.
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
            X-GreenSTAR-Tenant-ID:
              $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
          content:
            application/json:
              schema:
                type: object
                properties:
                  offset:
                    type: integer
                    example: 0
                  totalCount:
                    type: integer
                    example: 100
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/{{ .Name }}'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '500':
          $ref: '#/components/responses/500'
    {{- end }}
    {{- if .Create }}
    post:
      summary: Create a new {{ .Name | lower }}.
      tags:
        - "{{ .Name }}"
      parameters:
        - $ref: '#/components/parameters/X-GreenSTAR-Tenant-ID'
        - $ref: '#/components/parameters/X-Request-ID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/New{{ .Name }}'
      responses:
        '201':
          description: {{ .Name }} created.
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
            X-GreenSTAR-Tenant-ID:
              $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/{{ .Name }}'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '500':
          $ref: '#/components/responses/500'
    {{- end }}
  "{{ .Path }}/{id}":
    {{- if .Get }}
    get:
      summary: Fetch {{ .Name | lower }}.
      tags:
        - "{{ .Name }}"
      parameters:
        - $ref: '#/components/parameters/X-GreenSTAR-Tenant-ID'
        - $ref: '#/components/parameters/X-Request-ID'
        - $ref: '#/components/parameters/IDPathParameter'
      responses:
        '200':
          description: {{ .Name }} fetched.
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
            # TODO: add ETag header to GET item response, and also add If-Match + If-NotMatch
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/{{ .Name }}'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '500':
          $ref: '#/components/responses/500'
    {{- end }}
    {{- if .Update }}
    patch:
      summary: Patch {{ .Name | lower }}.
      tags:
        - "{{ .Name }}"
      parameters:
        - $ref: '#/components/parameters/X-GreenSTAR-Tenant-ID'
        - $ref: '#/components/parameters/X-Request-ID'
      requestBody:
        required: true
        description: Partial account.
        content:
          application/json:
            required: true
            schema:
              $ref: '#/components/schemas/Patch{{ .Name }}'
      responses:
        '200':
          description: {{ .Name }} updated.
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
            X-GreenSTAR-Tenant-ID:
              $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/{{ .Name }}'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '500':
          $ref: '#/components/responses/500'
    put:
      summary: Update {{ .Name | lower }}.
      tags:
        - "{{ .Name }}"
      parameters:
        - $ref: '#/components/parameters/X-GreenSTAR-Tenant-ID'
        - $ref: '#/components/parameters/X-Request-ID'
      requestBody:
        required: true
        description: New account properties.
        content:
          application/json:
            required: true
            schema:
              $ref: '#/components/schemas/Update{{ .Name }}'
      responses:
        '200':
          description: {{ .Name }} updated.
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
            X-GreenSTAR-Tenant-ID:
              $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/{{ .Name }}'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '500':
          $ref: '#/components/responses/500'
    {{- end }}
    {{- if .Delete }}
    delete:
      summary: Delete {{ .Name | lower }}.
      tags:
        - "{{ .Name }}"
      parameters:
        - $ref: '#/components/parameters/X-GreenSTAR-Tenant-ID'
        - $ref: '#/components/parameters/X-Request-ID'
      responses:
        '204':
          description: {{ .Name }} deleted.
          headers:
            X-Request-ID:
              $ref: '#/components/headers/X-Request-ID'
            X-GreenSTAR-Tenant-ID:
              $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '500':
          $ref: '#/components/responses/500'
    {{- end }}
  {{- end }}
components:
  headers:
    X-Request-ID:
      schema:
        type: string
        format: uuid
        example: 0e9bc950-bb20-4ef3-b18d-e62dbbd202dd
      description: Unique request ID.
    X-GreenSTAR-Tenant-ID:
      schema:
        type: string
        example: acme
      description: The ID of the tenant for which the request was sent for.
  parameters:
    X-Request-ID:
      name: X-Request-ID
      description: Unique ID assigned to each logical request.
      in: header
      schema:
        type: string
        format: uuid
        example: 0e9bc950-bb20-4ef3-b18d-e62dbbd202dd
    X-GreenSTAR-Tenant-ID:
      name: X-GreenSTAR-Tenant-ID
      description: The ID of the tenant for which the request is sent.
      in: header
      schema:
        type: string
        minLength: 1
    IDPathParameter:
      name: id
      description: The ID of the object.
      in: path
      required: true
      schema:
        type: string
        example: 0e9bc950-bb20-4ef3-b18d-e62dbbd202dd
  responses:
    '400':
      description: Bad request.
      headers:
        X-Request-ID:
          $ref: '#/components/headers/X-Request-ID'
        X-GreenSTAR-Tenant-ID:
          $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
      content:
        plain/text:
          schema:
            type: string
          example: Bad request.
    '403':
      description: Forbidden.
      headers:
        X-Request-ID:
          $ref: '#/components/headers/X-Request-ID'
        X-GreenSTAR-Tenant-ID:
          $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
      content:
        plain/text:
          schema:
            type: string
          example: Access denied.
    '500':
      description: Internal error.
      headers:
        X-Request-ID:
          $ref: '#/components/headers/X-Request-ID'
        X-GreenSTAR-Tenant-ID:
          $ref: '#/components/headers/X-GreenSTAR-Tenant-ID'
      content:
        plain/text:
          schema:
            type: string
          example: An internal error has occurred.
  schemas:
    {{- range .Models }}
    "{{ .Name }}":
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 0e9bc950-bb20-4ef3-b18d-e62dbbd202dd
        createdAt:
          type: string
          format: date-time
          example: '2017-07-21T17:32:28Z'
        updatedAt:
          type: string
          format: date-time
          example: '2017-07-21T17:32:28Z'
        {{- range $name, $p := .Properties }}
        "{{ $name | toLowerCamelCase }}":
          type: {{ $p.Type.OpenAPIType }}
          {{- if $p.Type.OpenAPIFormat }}
          format: {{ $p.Type.OpenAPIFormat }}
          {{- end }}
          nullable: {{ not .Required }}
        {{- end }}
    "New{{ .Name }}":
      type: object
      properties:
        {{- range $name, $p := .Properties }}
        {{- if not .ReadOnly }}
        "{{ $name | toLowerCamelCase }}":
          type: {{ $p.Type.OpenAPIType }}
          {{- if $p.Type.OpenAPIFormat }}
          format: {{ $p.Type.OpenAPIFormat }}
          {{- end }}
          nullable: {{ not .Required }}
        {{- end }}
        {{- end }}
    "Patch{{ .Name }}":
      type: object
      properties:
        {{- range $name, $p := .Properties }}
        {{- if not .ReadOnly }}
        "{{ $name | toLowerCamelCase }}":
          type: {{ $p.Type.OpenAPIType }}
          {{- if $p.Type.OpenAPIFormat }}
          format: {{ $p.Type.OpenAPIFormat }}
          {{- end }}
          nullable: true
        {{- end }}
        {{- end }}
    "Update{{ .Name }}":
      type: object
      properties:
        {{- range $name, $p := .Properties }}
        {{- if not .ReadOnly }}
        "{{ $name | toLowerCamelCase }}":
          type: {{ $p.Type.OpenAPIType }}
          {{- if $p.Type.OpenAPIFormat }}
          format: {{ $p.Type.OpenAPIFormat }}
          {{- end }}
          nullable: {{ not .Required }}
        {{- end }}
        {{- end }}
    {{- end }}
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
  - bearerAuth: [ ]
