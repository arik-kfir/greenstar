// Code generated by greenstar scripts; DO NOT EDIT.

package server

import (
	"errors"
	"github.com/descope/go-sdk/descope/client"

{{- range .Models }}
	"github.com/arikkfir/greenstar/backend/internal/server/resources/{{ .Name | lower }}"
	{{- end }}
	"github.com/arikkfir/greenstar/backend/internal/server/resources/openapi"
	"github.com/jackc/pgx/v5/pgxpool"
	"net/http"
)

type Server struct {
	Pool *pgxpool.Pool
	Descope *client.DescopeClient
	{{- range .Models }}
	{{ .Name | toPlural }}Handler {{ .Name | lower }}.Handler
	{{- end }}
}

func (s *Server) Register(mux *http.ServeMux) error {
	{{- range .Models }}
	if s.{{ .Name | toPlural }}Handler == nil {
		return errors.New("no {{ .Name | toPlural | lower }} handler was set on this server")
	}
	{{ .Name | lower }}.NewServer(s.Pool, s.{{ .Name | toPlural }}Handler).Register(mux)
	{{- end }}

	openapi.NewServer().Register(mux)

	return nil
}
