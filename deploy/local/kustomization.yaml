apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../base
  - ingress.yaml
configMapGenerator:
  - name: greenstar-backend-config
    behavior: create
    envs: [ config/greenstar-backend-config.env ]
  - name: greenstar-frontend-config
    behavior: create
    envs: [ config/greenstar-frontend-config.env ]
secretGenerator:
  - name: greenstar-backend-secrets
    behavior: create
    envs: [ config/greenstar-backend-secrets.env ]
  - name: greenstar-frontend-secrets
    behavior: create
    envs: [ config/greenstar-frontend-secrets.env ]
  - name: greenstar-backend-tls
    type: kubernetes.io/tls
    behavior: create
    files:
      - tls.crt=tls/api.greenstar.test.pem
      - tls.key=tls/api.greenstar.test-key.pem
  - name: greenstar-frontend-tls
    type: kubernetes.io/tls
    behavior: create
    files:
      - tls.crt=tls/_wildcard.greenstar.test.pem
      - tls.key=tls/_wildcard.greenstar.test-key.pem
patches:

  - target:
      group: apps
      version: v1
      kind: Deployment
      labelSelector: app.kubernetes.io/component=frontend
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/startupProbe/initialDelaySeconds
        value: 10
      - op: replace
        path: /spec/template/spec/containers/0/startupProbe/timeoutSeconds
        value: 30
      - op: replace
        path: /spec/template/spec/containers/0/resources
        value:
          limits:
            cpu: 2000m
            memory: 4Gi
          requests:
            cpu: 2000m
            memory: 4Gi
